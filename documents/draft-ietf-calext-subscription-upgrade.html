<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Calendar subscription upgrades</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Terms and Definitions">
<link href="#rfc.section.2" rel="Chapter" title="2 Discovering alternative access methods">
<link href="#rfc.section.3" rel="Chapter" title="3 Enhanced GET">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 General">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Deletions">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Handling of invalid sync tokens">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Paging the response">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Caching of responses">
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 Examples">
<link href="#rfc.section.4" rel="Chapter" title="4 Changes to the iCalendar specifications">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Redefined Status property">
<link href="#rfc.section.5" rel="Chapter" title="5 Header Field: Sync-Token">
<link href="#rfc.section.6" rel="Chapter" title="6 New Prefer header field preferences">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Preference subscribe-enhanced-get">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Preference limit">
<link href="#rfc.section.7" rel="Chapter" title="7 Link relations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 General">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 subscribe-caldav">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 subscribe-caldav-auth">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 subscribe-webdav-sync">
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 subscribe-enhanced-get">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 Sync-Token HTTP Header Field Registration">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 Preference Registrations">
<link href="#rfc.section.9.3" rel="Chapter" title="9.3 Link Relation Registrations">
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="11 Normative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Open issues">
<link href="#rfc.appendix.B" rel="Chapter" title="B Change log">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.31.0 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Douglass, M." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-calext-subscription-upgrade-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-06-07" />
  <meta name="dct.abstract" content="This specification introduces an approach to allow subscribers to calendar feeds to upgrade to a more performant protocol.This specification updates  to add the value DELETED to the STATUS property.This specification also updates  to add the subscribe- enhanced-get and limit preferences." />
  <meta name="description" content="This specification introduces an approach to allow subscribers to calendar feeds to upgrade to a more performant protocol.This specification updates  to add the value DELETED to the STATUS property.This specification also updates  to add the subscribe- enhanced-get and limit preferences." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Douglass</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Spherical Cow Group</td>
</tr>
<tr>
<td class="left">Updates: 5988,7240 (if approved)</td>
<td class="right">June 7, 2019</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right"></td>
</tr>
<tr>
<td class="left">Expires: December 9, 2019</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Calendar subscription upgrades<br />
  <span class="filename">draft-ietf-calext-subscription-upgrade-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This specification introduces an approach to allow subscribers to calendar feeds to upgrade to a more performant protocol.</p>
<p>This specification updates <a href="#RFC5545" class="xref">[RFC5545]</a> to add the value DELETED to the STATUS property.</p>
<p>This specification also updates <a href="#RFC7240" class="xref">[RFC7240]</a> to add the subscribe- enhanced-get and limit preferences.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 9, 2019.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Terms and Definitions</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Discovering alternative access methods</a>
</li>
<li>3.   <a href="#rfc.section.3">Enhanced GET</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">General</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Deletions</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Handling of invalid sync tokens</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Paging the response</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Caching of responses</a>
</li>
<li>3.6.   <a href="#rfc.section.3.6">Examples</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Changes to the iCalendar specifications</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Redefined Status property</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Header Field: Sync-Token</a>
</li>
<li>6.   <a href="#rfc.section.6">New Prefer header field preferences</a>
</li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Preference subscribe-enhanced-get</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Preference limit</a>
</li>
</ul><li>7.   <a href="#rfc.section.7">Link relations</a>
</li>
<ul><li>7.1.   <a href="#rfc.section.7.1">General</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">subscribe-caldav</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">subscribe-caldav-auth</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">subscribe-webdav-sync</a>
</li>
<li>7.5.   <a href="#rfc.section.7.5">subscribe-enhanced-get</a>
</li>
</ul><li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<ul><li>9.1.   <a href="#rfc.section.9.1">Sync-Token HTTP Header Field Registration</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">Preference Registrations</a>
</li>
<li>9.3.   <a href="#rfc.section.9.3">Link Relation Registrations</a>
</li>
</ul><li>10.   <a href="#rfc.section.10">Acknowledgements</a>
</li>
<li>11.   <a href="#rfc.references">Normative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.A">Open issues</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.B">Change log</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Currently clients subscribe to calendar feeds as an iCalendar file which is often published as a resource accessible using the unofficial 'webcal' scheme.</p>
<p id="rfc.section.1.p.2">The only available option for updating that resource is the usual HTTP polling of cached resources using Etags.</p>
<p id="rfc.section.1.p.3">There is the usual tension between clients wishing to see a timely response to changes and servers not wishing to be overloaded by frequent requests for possibly large amounts of data.</p>
<p id="rfc.section.1.p.4">This specification introduces an approach whereby clients can discover a more performant access method.  Given the location of the resource as an iCalendar file, the client can perfom a HEAD request on the resource and inspect the returned headers which will offer a number of alternative access methods.</p>
<p id="rfc.section.1.p.5">Given that many clients and servers already support CalDAV this provides an easy upgrade path for those clients.  CalDAV and DAV subsets are specified here to allow lighter weight implementations.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#conventions" id="conventions">Terms and Definitions</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.</p>
<p id="rfc.section.1.1.p.2">Additionally, the rule for URI is included from <a href="#RFC3986" class="xref">[RFC3986]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#_discovering_alternative_access_methods" id="_discovering_alternative_access_methods">Discovering alternative access methods</a>
</h1>
<p id="rfc.section.2.p.1">The advertising of other access points is achieved through the use of the LINK header as defined in <a href="#RFC5988" class="xref">[RFC5988]</a>.  New link relation types are defined in this specification - each being associated with a protocol or protocol subset.</p>
<p id="rfc.section.2.p.2">These LINK headers will be delivered when a client carries out a HEAD request targeting the URL of the resource.</p>
<p>This is an example of a HEAD request and the response from a server that supports the enhanced GET method.</p>
<pre>
    &gt;&gt; Request &lt;&lt;

    HEAD /caldata/events.ics HTTP/1.1
    Host: example.com
    Accept: text/calendar

    &gt;&gt; Response &lt;&lt;

    HTTP/1.1 200 OK
    Content-Length: xxxx
    Link: &lt;http://example.com/subscribe/events.ics&gt;;
                 rel="subscribe-enhanced-get"

</pre>
<p id="rfc.section.2.p.3">Note that the target for an upgraded service may be the same as for the initial resource.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#enhanced-get" id="enhanced-get">Enhanced GET</a>
</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#_general" id="_general">General</a>
</h1>
<p id="rfc.section.3.1.p.1">This is a lightweight protocol which allows simple clients to efficiently discover and download changes in the targeted resource.</p>
<p id="rfc.section.3.1.p.2">It has many similarities to WebDAV sync and for a server could be implemented as an extension of the specification.</p>
<p id="rfc.section.3.1.p.3">In this protocol the client MUST include the Prefer header field preference "subscribe-enhanced-get". If a sync token is available it is passed as a Sync-Token header field.</p>
<p id="rfc.section.3.1.p.4">The resource is treated as a set of individual events each of which may be updated or deleted separately. The client will first fetch the entire iCalendar file.  On subsequent requests it uses the Prefer header field and a Sync-Token header field to indicate that it wants a set of changes since the last fetch.</p>
<p id="rfc.section.3.1.p.5">If no Sync-Token header field is supplied the server SHOULD respond with a full set of data. Otherwise, if the token is valid, it SHOULD return with a set of changed entities.</p>
<p id="rfc.section.3.1.p.6">In both cases the server should set the Preference-Applied header field and a new Sync-Token header field value.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#_deletions" id="_deletions">Deletions</a>
</h1>
<p id="rfc.section.3.2.p.1">When an entity (VEVENT, VTODO or other valid top-level component) is deleted from the source data the server needs to be able to inform a client of the deletion.  This specification introduces a new value for the STATUS property of DELETED.</p>
<p id="rfc.section.3.2.p.2">On the first enhanced GET after the entity has been deleted a skeleton, but valid, entity will be returned with STATUS: DELETED.  The receiving client is free to remove the entity or update it&#8217;s STATUS property.</p>
<p id="rfc.section.3.2.p.3">On subsequent fetches the entity will not be returned.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#_handling_of_invalid_sync_tokens" id="_handling_of_invalid_sync_tokens">Handling of invalid sync tokens</a>
</h1>
<p id="rfc.section.3.3.p.1">When a server receives an invalid token it MUST return a 409 status (Conflict).  The server MAY choose to return an error message in the body.</p>
<p id="rfc.section.3.3.p.2">The client SHOULD respond to this error by restarting the interaction from scratch, i.e. retrieve the full set of data then poll for updates.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#_paging_the_response" id="_paging_the_response">Paging the response</a>
</h1>
<p id="rfc.section.3.4.p.1">A client may explicitly request a limit on the size of the response by specifying the Prefer header field preference "limit=n" where n is the number of components.</p>
<p id="rfc.section.3.4.p.2">When a server receives a request specifying such a limit it SHOULD limit the response to that number of components.  If the limit causes a truncation in the response the server should respond with a Preference-Applied header specifying the limit that was applied and return a sync token which may be used to retrieve the next batch of data.</p>
<p id="rfc.section.3.4.p.3">This allows the client to immediately resubmit a request for the next batch using the updated token.</p>
<p id="rfc.section.3.4.p.4">A server MAY choose to limit the response size.  The behavior SHOULD be as if the client had provided a preference for that size - allowing the client to retrieve the full set of data in batches.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#_caching_of_responses" id="_caching_of_responses">Caching of responses</a>
</h1>
<p id="rfc.section.3.5.p.1">To enable proper caching of responses the server SHOULD provide a VARY header field in responses that names the Prefer and Sync-Token header fields along with any other that are appropriate.</p>
<p id="rfc.section.3.5.p.2">Clients should order the preferences as following so that identical responses can be identified:</p>
<p></p>

<ul>
<li>subscribe-enhanced-get</li>
<li>limit</li>
</ul>
<h1 id="rfc.section.3.6">
<a href="#rfc.section.3.6">3.6.</a> <a href="#_examples" id="_examples">Examples</a>
</h1>
<p>This is an example of the initial request and response from a server that supports the enhanced GET method. Note the use of the Vary header so a caching proxy can key off the client&#8217;s Sync-Token and preference.</p>
<pre>
    &gt;&gt; Request &lt;&lt;

    GET /events.ics HTTP/1.1
    Host: example.com
    Accept: text/calendar
    Prefer: subscribe-enhanced-get

    &gt;&gt; Response &lt;&lt;

    HTTP/1.1 200 OK
    Content-Length: xxxx
    Sync-Token: "data:,1234567"
    Preference-Applied: subscribe-enhanced-get
    Vary: Prefer, Sync-Token

    BEGIN:VCALENDAR:
    ?  /* full feed */
    END:VCALENDAR
</pre>
<p>This is an example of the subsequent request and response when no changes have occurred.</p>
<pre>
    &gt;&gt; Request &lt;&lt;

    GET /events.ics HTTP/1.1
    Host: example.com
    Accept: text/calendar
    Prefer: subscribe-enhanced-get
    Sync-Token: "data:,1234567"

    &gt;&gt; Response &lt;&lt;

    HTTP/1.1 304 Not Modified
    Content-Length: 0
    Sync-Token: "data:,1234567"
    Preference-Applied: subscribe-enhanced-get
    Vary: Prefer, Sync-Token
</pre>
<p>This is an example of the subsequent request and response for an old or invalid token.</p>
<pre>
&gt;&gt; Request &lt;&lt;

    GET /events.ics HTTP/1.1
    Host: example.com
    Accept: text/calendar
    Sync-Token: "data:,1234567"
    Prefer: subscribe-enhanced-get

    &gt;&gt; Response &lt;&lt;

    HTTP/1.1 409 Conflict
    Content-Length: xxxx
    Preference-Applied: subscribe-enhanced-get

</pre>
<p>This is an example of the subsequent request and response when changes have occurred.</p>
<pre>
&gt;&gt; Request &lt;&lt;

    GET /events.ics HTTP/1.1
    Host: example.com
    Accept: text/calendar
    Sync-Token: "data:,1234567"
    Prefer: subscribe-enhanced-get

    &gt;&gt; Response &lt;&lt;

    HTTP/1.1 200 OK
    Content-Type: text/calendar
    Vary: Prefer, Sync-Token
    Sync-Token: "data:,4567890"
    Preference-Applied: subscribe-enhanced-get

    BEGIN:VCALENDAR:
    ...  only new/changed events
    ...  deleted events have STATUS:DELETED
    END:VCALENDAR
</pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#_changes_to_the_icalendar_specifications" id="_changes_to_the_icalendar_specifications">Changes to the iCalendar specifications</a>
</h1>
<p id="rfc.section.4.p.1">This specification updates <a href="#RFC5545" class="xref">[RFC5545]</a> to add the value DELETED to the STATUS property.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#_redefined_status_property" id="_redefined_status_property">Redefined Status property</a>
</h1>
<p></p>

<dl>
<dt>Property name</dt>
<dd style="margin-left: 8">
<br>STATUS</dd>
<dt>Purpose</dt>
<dd style="margin-left: 8">
<br>This property defines the overall status or confirmation for the calendar component.</dd>
<dt>Value Type</dt>
<dd style="margin-left: 8">
<br>TEXT</dd>
<dt>Property Parameters</dt>
<dd style="margin-left: 8">
<br>IANA and non-standard property parameters can be specified on this property.</dd>
<dt>Conformance</dt>
<dd style="margin-left: 8">
<br>This property can be specified once in "VEVENT", "VTODO", or "VJOURNAL" calendar components.</dd>
<dt>Description</dt>
<dd style="margin-left: 8">
<br>In a group-scheduled calendar component, the property is used by the "Organizer" to provide a confirmation of the event to the "Attendees".  For example in a "VEVENT" calendar component, the "Organizer" can indicate that a meeting is tentative, confirmed, or cancelled.  In a "VTODO" calendar component, the "Organizer" can indicate that an action item needs action, is completed, is in process or being worked on, or has been cancelled.  In a "VJOURNAL" calendar component, the "Organizer" can indicate that a journal entry is draft, final, or has been cancelled or removed.</dd>
<dt>Format Definition</dt>
<dd style="margin-left: 8"></dd>
</dl>
<p id="rfc.section.4.1.p.2">This property is defined by the following notation:</p>
<pre>
status          = "STATUS" statparam ":" statvalue CRLF

statparam       = *(";" other-param)

statvalue       = (statvalue-event
                /  statvalue-todo
                /  statvalue-jour)

statvalue-event = "TENTATIVE"    ;Indicates event is tentative.
                / "CONFIRMED"    ;Indicates event is definite.
                / "CANCELLED"    ;Indicates event was cancelled.
                / "DELETED"      ;Indicates event was deleted.
;Status values for a "VEVENT"

statvalue-todo  = "NEEDS-ACTION" ;Indicates to-do needs action.
                / "COMPLETED"    ;Indicates to-do completed.
                / "IN-PROCESS"   ;Indicates to-do in process of.
                / "CANCELLED"    ;Indicates to-do was cancelled.
                / "DELETED"      ;Indicates to-do was deleted.
;Status values for "VTODO".

statvalue-jour  = "DRAFT"        ;Indicates journal is draft.
                / "FINAL"        ;Indicates journal is final.
                / "CANCELLED"    ;Indicates journal is removed.
                / "DELETED"      ;Indicates journal was deleted.
;Status values for "VJOURNAL".
</pre>
<p></p>

<dl>
<dt>Example</dt>
<dd style="margin-left: 8"></dd>
</dl>
<p>The following is an example of this property for a "VEVENT" calendar component:</p>
<pre>
STATUS:TENTATIVE
</pre>
<p>The following is an example of this property for a "VTODO" calendar component:</p>
<pre>
STATUS:NEEDS-ACTION
</pre>
<p>The following is an example of this property for a "VJOURNAL" calendar component:</p>
<pre>
STATUS:DRAFT
</pre>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#_header_field_sync_token" id="_header_field_sync_token">Header Field: Sync-Token</a>
</h1>
<p id="rfc.section.5.p.1">This specification defines a new header field Sync-Token for use by the enhanced GET method.</p>
<pre>
    Accept = DQUOTE URI DQUOTE
</pre>
<p id="rfc.section.5.p.2">The value MUST be a URI. This will generally be a data URI representing an opaque token. Client MUST not attempt to interpret the data URI value.</p>
<p>This is an example of the Sync-Token header field:</p>
<pre>
    Sync-Token: "data:,1234567"
</pre>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#_new_prefer_header_field_preferences" id="_new_prefer_header_field_preferences">New Prefer header field preferences</a>
</h1>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#preference-subscribe" id="preference-subscribe">Preference subscribe-enhanced-get</a>
</h1>
<p id="rfc.section.6.1.p.1">This indicates that the client expects the server to handle the GET method according to the specifications for enhanced get.</p>
<pre>
    pref-subscribe-enhanced-get = "subscribe-enhanced-get"
</pre>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#preference-limit" id="preference-limit">Preference limit</a>
</h1>
<p id="rfc.section.6.2.p.1">This preference parameter provides a limit on the number of components returned for enhanced get.</p>
<pre>
    pref-limit = "limit" BWS "=" BWS 1*DIGIT
</pre>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#_link_relations" id="_link_relations">Link relations</a>
</h1>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#_general_2" id="_general_2">General</a>
</h1>
<p id="rfc.section.7.1.p.1">This clause defines a number of new link relations required to facilitate subscription upgrades.</p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> <a href="#la-subscribe-caldav" id="la-subscribe-caldav">subscribe-caldav</a>
</h1>
<p id="rfc.section.7.2.p.1">This specifies an access point which is a full implementation of caldav but requires no authentication.  The end point allows the full range of reports as defined by the CalDAV specification.</p>
<p id="rfc.section.7.2.p.2">The client MUST follow the specification to determine exactly what operations are allowed on the access point - for example to determine if sync-report is supported.</p>
<p id="rfc.section.7.2.p.3">The URL MAY include some form of token to allow write access to the targeted collection.  The client must check it&#8217;s permissions to determine whether or not it has been granted write access.</p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> <a href="#la-subscribe-caldav-auth" id="la-subscribe-caldav-auth">subscribe-caldav-auth</a>
</h1>
<p id="rfc.section.7.3.p.1">This specifies an access point which is a full implementation of caldav and requires authentication.  This may allow read-write access to the resource.</p>
<p id="rfc.section.7.3.p.2">The client MUST follow the specification to determine exactly what operations are allowed on the access point&#8201;&#8212;&#8201;for example to determine if sync-report is supported.</p>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> <a href="#la-subscribe-webdav-sync" id="la-subscribe-webdav-sync">subscribe-webdav-sync</a>
</h1>
<p id="rfc.section.7.4.p.1">This specifies an access point which supports only webdav sync.</p>
<p id="rfc.section.7.4.p.2">This allows the client to issue a sync-report on the resource to obtain updates.</p>
<p id="rfc.section.7.4.p.3">The client MUST follow that specification.</p>
<h1 id="rfc.section.7.5">
<a href="#rfc.section.7.5">7.5.</a> <a href="#la-subscribe-enhanced-get" id="la-subscribe-enhanced-get">subscribe-enhanced-get</a>
</h1>
<p id="rfc.section.7.5.p.1">This specifies an access point which supports something new.</p>
<p id="rfc.section.7.5.p.2">The client MUST follow that specification.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.8.p.1">Applications using these properties need to be aware of the risks entailed in using the URIs provided as values.  See <a href="#RFC3986" class="xref">[RFC3986]</a> for a discussion of the security considerations relating to URIs.  == Privacy Considerations</p>
<p id="rfc.section.8.p.2">Properties with a "URI" value type can expose their users to privacy leaks as any network access of the URI data can be tracked.  Clients SHOULD NOT automatically download data referenced by the URI without explicit instruction from users.  This specification does not introduce any additional privacy concerns beyond those described in <a href="#RFC5545" class="xref">[RFC5545]</a>.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> <a href="#_sync_token_http_header_field_registration" id="_sync_token_http_header_field_registration">Sync-Token HTTP Header Field Registration</a>
</h1>
<p id="rfc.section.9.1.p.1">This specification updates the "Message Headers" registry entry for "Sync-Token" in <a href="#RFC3864" class="xref">[RFC3864]</a> to refer to this document.</p>
<pre>
Header Field Name: Sync-Token
Protocol: http
Status: standard
Reference: &lt;this-document&gt;
</pre>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> <a href="#_preference_registrations" id="_preference_registrations">Preference Registrations</a>
</h1>
<p id="rfc.section.9.2.p.1">The following preferences have been added to the HTTP Preferences Registry defined in <a href="#RFC7240" class="xref">[RFC7240]</a></p>
<p></p>

<dl>
<dt>Preference</dt>
<dd style="margin-left: 8">
<br>subscribe-enhanced-get</dd>
<dt>Value</dt>
<dd style="margin-left: 8">
<br>None.</dd>
<dt>Description</dt>
<dd style="margin-left: 8">
<br>Marks the interaction as enhanced get and provides the optional sync-token and page size.</dd>
<dt>Reference</dt>
<dd style="margin-left: 8">
<br>this document</dd>
<dt>Preference</dt>
<dd style="margin-left: 8">
<br>limit</dd>
<dt>Value</dt>
<dd style="margin-left: 8">
<br>An integer page size.</dd>
<dt>Description</dt>
<dd style="margin-left: 8">
<br>Provide a limit on the number of components in the response.</dd>
<dt>Reference</dt>
<dd style="margin-left: 8">
<br>this document</dd>
</dl>
<h1 id="rfc.section.9.3">
<a href="#rfc.section.9.3">9.3.</a> <a href="#_link_relation_registrations" id="_link_relation_registrations">Link Relation Registrations</a>
</h1>
<p id="rfc.section.9.3.p.1">This document defines the following new iCalendar properties to be added to the registry defined in <a href="#RFC5545" class="xref">section=8.2.3</a>:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Relation Name</th>
<th class="left">Description</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">subscribe-caldav</td>
<td class="left">Current</td>
<td class="left"><a href="#la-subscribe-caldav" class="xref">Section 7.2</a></td>
</tr>
<tr>
<td class="left">subscribe-caldav_auth</td>
<td class="left">Current</td>
<td class="left"><a href="#la-subscribe-caldav-auth" class="xref">Section 7.3</a></td>
</tr>
<tr>
<td class="left">subscribe-webdav-sync</td>
<td class="left">Current</td>
<td class="left"><a href="#la-subscribe-webdav-sync" class="xref">Section 7.4</a></td>
</tr>
<tr>
<td class="left">subscribe-enhanced_get</td>
<td class="left">Current</td>
<td class="left"><a href="#la-subscribe-enhanced-get" class="xref">Section 7.5</a></td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.10.p.1">The author would also like to thank the members of the CalConnect Calendar Sharing technical committee and the following individuals for contributing their ideas and support:</p>
<p id="rfc.section.10.p.2">Marten Gajda, Ken Murchison, Garry Shutler</p>
<p id="rfc.section.10.p.3">The authors would also like to thank CalConnect, the Calendaring and Scheduling Consortium, for advice with this specification.</p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-calext-extensions">[I-D.ietf-calext-extensions]</b></td>
<td class="top">
<a>Daboo, C.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-calext-extensions-05">New Properties for iCalendar</a>", Internet-Draft draft-ietf-calext-extensions-05, August 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2434">[RFC2434]</b></td>
<td class="top">
<a>Narten, T.</a> and <a>H. Alvestrand</a>, "<a href="https://tools.ietf.org/html/rfc2434">Guidelines for Writing an IANA Considerations Section in RFCs</a>", RFC 2434, DOI 10.17487/RFC2434, October 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3688">[RFC3688]</b></td>
<td class="top">
<a>Mealling, M.</a>, "<a href="https://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>", BCP 81, RFC 3688, DOI 10.17487/RFC3688, January 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3864">[RFC3864]</b></td>
<td class="top">
<a>Klyne, G.</a>, <a>Nottingham, M.</a> and <a>J. Mogul</a>, "<a href="https://tools.ietf.org/html/rfc3864">Registration Procedures for Message Header Fields</a>", BCP 90, RFC 3864, DOI 10.17487/RFC3864, September 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3986">[RFC3986]</b></td>
<td class="top">
<a>Berners-Lee, T.</a>, <a>Fielding, R.</a> and <a>L. Masinter</a>, "<a href="https://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, DOI 10.17487/RFC3986, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4589">[RFC4589]</b></td>
<td class="top">
<a>Schulzrinne, H.</a> and <a>H. Tschofenig</a>, "<a href="https://tools.ietf.org/html/rfc4589">Location Types Registry</a>", RFC 4589, DOI 10.17487/RFC4589, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5545">[RFC5545]</b></td>
<td class="top">
<a>Desruisseaux, B.</a>, "<a href="https://tools.ietf.org/html/rfc5545">Internet Calendaring and Scheduling Core Object Specification (iCalendar)</a>", RFC 5545, DOI 10.17487/RFC5545, September 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5546">[RFC5546]</b></td>
<td class="top">
<a>Daboo, C.</a>, "<a href="https://tools.ietf.org/html/rfc5546">iCalendar Transport-Independent Interoperability Protocol (iTIP)</a>", RFC 5546, DOI 10.17487/RFC5546, December 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5988">[RFC5988]</b></td>
<td class="top">
<a>Nottingham, M.</a>, "<a href="https://tools.ietf.org/html/rfc5988">Web Linking</a>", RFC 5988, DOI 10.17487/RFC5988, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6578">[RFC6578]</b></td>
<td class="top">
<a>Daboo, C.</a> and <a>A. Quillaud</a>, "<a href="https://tools.ietf.org/html/rfc6578">Collection Synchronization for Web Distributed Authoring and Versioning (WebDAV)</a>", RFC 6578, DOI 10.17487/RFC6578, March 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7240">[RFC7240]</b></td>
<td class="top">
<a>Snell, J.</a>, "<a href="https://tools.ietf.org/html/rfc7240">Prefer Header for HTTP</a>", RFC 7240, DOI 10.17487/RFC7240, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7991">[RFC7991]</b></td>
<td class="top">
<a>Hoffman, P.</a>, "<a href="https://tools.ietf.org/html/rfc7991">The "xml2rfc" Version 3 Vocabulary</a>", RFC 7991, DOI 10.17487/RFC7991, December 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
<tr>
<td class="reference"><b id="W3C.REC-xml-20060816">[W3C.REC-xml-20060816]</b></td>
<td class="top">
<a>Bray, T.</a>, <a>Paoli, J.</a>, <a>Sperberg-McQueen, M.</a>, <a>Maler, E.</a> and <a>F. Yergeau</a>, "<a href="http://www.w3.org/TR/2006/REC-xml-20060816">Extensible Markup Language (XML) 1.0 (Fourth Edition)</a>", World Wide Web Consortium Recommendation REC-xml-20060816, August 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#appendix-a" id="appendix-a">Open issues</a>
</h1>
<p></p>

<dl>
<dt>Vary</dt>
<dd style="margin-left: 8">
<br>Ensure we get that right.</dd>
</dl>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#appendix-b" id="appendix-b">Change log</a>
</h1>
<p id="rfc.section.B.p.1">calext00 2019-06-05 MD</p>
<p></p>

<ul>
<li>First calext version</li>
<li>Use Sync-Token header rather than parameter</li>
</ul>
<p id="rfc.section.B.p.3">v04 2019-03-07 MD</p>
<p></p>

<ul>
<li>Reference to RFC 6538 - WebDAV sync and RFC 7240 Prefer</li>
<li>Go back to HEAD</li>
<li>New Preference and parameters.</li>
<li>Examples</li>
<li>More text for extended get.  Talk about deletions.</li>
</ul>
<p id="rfc.section.B.p.5">v01 2017-02-17 MD</p>
<p></p>

<ul>
<li>Add text about OPTIONS</li>
<li>Add text abut read/write CalDAV</li>
</ul>
<p id="rfc.section.B.p.7">v00 2017-02-15 MD</p>
<p></p>

<ul><li>First pass</li></ul>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Michael Douglass</span> 
	  <span class="n hidden">
		<span class="family-name">Douglass</span>
	  </span>
	</span>
	<span class="org vcardline">Spherical Cow Group</span>
	<span class="adr">
	  <span class="vcardline">226 3rd Street</span>

	  <span class="vcardline">
		<span class="locality">Troy</span>,  
		<span class="region"></span>
		<span class="code">12180</span>
	  </span>
	  <span class="country-name vcardline">United States of America</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mdouglass@sphericalcowgroup.com">mdouglass@sphericalcowgroup.com</a></span>

<span class="vcardline">URI: <a href="http://sphericalcowgroup.com">http://sphericalcowgroup.com</a></span>

  </address>
</div>

</body>
</html>
